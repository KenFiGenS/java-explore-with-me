--DROP TABLE IF EXISTS USERS, CATEGORIES, EVENTS, REQUESTS, COMPILATIONS, EVENTS_COMPILATIONS;

CREATE TABLE IF NOT EXISTS USERS (
  USER_ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  NAME VARCHAR (250),
  EMAIL VARCHAR (254) UNIQUE
);

CREATE TABLE IF NOT EXISTS CATEGORIES (
  CATEGORY_ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  CATEGORY_NAME VARCHAR (50) UNIQUE
);

CREATE TABLE IF NOT EXISTS EVENTS (
  EVENT_ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  TITLE VARCHAR (120),
  ANNOTATION VARCHAR (2000),
  CATEGORY_ID INT NOT NULL REFERENCES CATEGORIES (CATEGORY_ID),
  PAID BOOLEAN,
  EVENT_DATE TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  USER_ID INT NOT NULL REFERENCES USERS (USER_ID) ON DELETE CASCADE,
  DESCRIPTION VARCHAR (7000),
  PARTICIPANT_LIMIT INT,
  STATE INT,
  CREATED_ON TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  PUBLISHED_ON TIMESTAMP WITHOUT TIME ZONE,
  LAT FLOAT,
  LON FLOAT,
  REQUEST_MODERATION BOOLEAN,
  CONFIRMED_REQUESTS INT
);

CREATE TABLE IF NOT EXISTS REQUESTS (
  REQUEST_ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  CREATED TIMESTAMP WITHOUT TIME ZONE NOT NULL,
  EVENT_ID INT NOT NULL REFERENCES EVENTS (EVENT_ID) ON DELETE CASCADE,
  USER_ID INT NOT NULL REFERENCES USERS (USER_ID) ON DELETE CASCADE,
  STATUS INT,
  PRIMARY KEY (USER_ID, EVENT_ID)
);

CREATE TABLE IF NOT EXISTS COMPILATIONS (
  COMPILATION_ID INT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
  PINNED BOOLEAN,
  TITLE VARCHAR (50)
);

CREATE TABLE IF NOT EXISTS EVENTS_COMPILATIONS (
  EVENT_ID INT NOT NULL REFERENCES EVENTS (EVENT_ID) ON DELETE CASCADE,
  COMPILATION_ID INT NOT NULL REFERENCES COMPILATIONS (COMPILATION_ID) ON DELETE CASCADE,
  PRIMARY KEY (EVENT_ID, COMPILATION_ID)
);